id: org.jackhuang.hmcl
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk17
rename-desktop-file: HMCL.desktop
rename-appdata-file: HMCL.appdata.xml
rename-icon: HMCL
command: HMCL
finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
  - --persist=.minecraft
  - --env=PATH=/app/jre/bin:/usr/bin:/app/bin

modules:
  - name: jre
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk17/install.sh

  - name: javafx
    buildsystem: simple
    build-commands:
      - mkdir -p /app/javafx
      - cp -r ./ /app/javafx
    sources:
      - type: archive
        only-arches: [x86_64]
        url: https://download2.gluonhq.com/openjfx/17.0.1/openjfx-17.0.1_linux-x64_bin-sdk.zip
        sha256: bb901fa4cfc5d1a2ded2d03c0d4782d47dec6a6a4dc344f48e6f2096b1008569
      - type: archive
        only-arches: [aarch64]
        url: https://download2.gluonhq.com/openjfx/17.0.1/openjfx-17.0.1_linux-aarch64_bin-sdk.zip
        sha256: 16b647e6cbb9dc5c4b3547ce0ab5b57ff9f78497437180af5badc6f2ce45ba60

  - name: HMCL
    buildsystem: simple
    build-commands:
      - exit 0
    post-install:
      - install -Dm644 HMCL.jar -t /app/HMCL
      - install -Dm755 HMCL.sh /app/bin/HMCL
      - install -Dm644 HMCL.desktop -t /app/share/applications
      - install -Dm644 HMCL.png -t /app/share/icons/hicolor/128x128/apps
      - install -Dm644 HMCL.appdata.xml -t /app/share/metainfo
    sources:
      - type: file
        dest-filename: HMCL.jar 
        url: http://ci.huangyuhui.net/job/HMCL/lastSuccessfulBuild/artifact/HMCL/build/libs/HMCL-3.4.208.jar
        sha256: 7ec4e6c257443cfc0434369a233be1358707b91b3b0e80b276022a13ec8d5625

      - type: file
        path: HMCL.desktop

      - type: file
        path: HMCL.png

      - type: file
        path: HMCL.appdata.xml

      - type: script
        dest-filename: HMCL.sh
        commands:
          - mkdir -p $XDG_DATA_HOME/HMCL
          - cd $XDG_DATA_HOME/HMCL || (echo "Cann't open $XDG_DATA_HOME/HMCL" && exit 1)
          - exec java 
            --module-path /app/javafx/lib 
            --add-modules=javafx.base,javafx.fxml,javafx.graphics,javafx.media,javafx.swing,javafx.web,javafx.controls 
            -jar /app/HMCL/HMCL.jar
